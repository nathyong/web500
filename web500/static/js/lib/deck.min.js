"use strict";var Deck=function(){function n(n,e){var o=Date.now(),r=o+n,i=r+e,u={start:r,end:i};g.push(u),x||(x=!0,requestAnimationFrame(t));var a={start:function(n){return u.startcb=n,a},progress:function(n){return u.progresscb=n,a},end:function(n){return u.endcb=n,a}};return a}function t(){var n=Date.now();if(!g.length)return void(x=!1);for(var e,o=0;o<g.length;o++)if(e=g[o],!(n<e.start)){e.started||(e.started=!0,e.startcb&&e.startcb());var r=(n-e.start)/(e.end-e.start);e.progresscb&&e.progresscb(1>r?r:1),n>e.end&&(e.endcb&&e.endcb(),g.splice(o--,1))}requestAnimationFrame(t)}function e(n){if("undefined"!=typeof S[n])return S[n];if("undefined"!=typeof M[n])return S[n]=n,n;for(var t,e=n[0].toUpperCase()+n.slice(1),o=["webkit","moz","Moz","ms","o"],r=0,i=o.length;i>r;r++)if(t=o[r]+e,"undefined"!=typeof M[t])return S[n]=t,t}function o(n,t,e){return"undefined"!=typeof b||(b=r()),e=e||0,b?"translate3d("+n+", "+t+", "+e+")":"translate("+n+", "+t+")"}function r(){var n=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(!n)return!1;var t=e("transform"),o=document.createElement("p");return document.body.appendChild(o),o.style[t]="translate3d(1px,1px,1px)",b=o.style[t],b=null!=b&&b.length&&"none"!==b,document.body.removeChild(o),b}function i(n){return document.createElement(n)}function u(t){function r(n){n.card&&n.card(I)}function u(n){function t(n){q&&("mousemove"===n.type?(i.x=n.clientX,i.y=n.clientY):(i.x=n.touches[0].clientX,i.y=n.touches[0].clientY),b.style[p]=o(Math.round(I.x+i.x-r.x)+"px",Math.round(I.y+i.y-r.y)+"px")+(I.rot?" rotate("+I.rot+"deg)":""))}function e(n){C&&Date.now()-u<200&&I.setSide("front"===I.side?"back":"front"),"mouseup"===n.type?(d(window,"mousemove",t),d(window,"mouseup",e)):(d(window,"touchmove",t),d(window,"touchend",e)),q&&(I.x=I.x+i.x-r.x,I.y=I.y+i.y-r.y)}var r={},i={},u=Date.now();n.preventDefault(),"mousedown"===n.type?(r.x=i.x=n.clientX,r.y=i.y=n.clientY,c(window,"mousemove",t),c(window,"mouseup",e)):(r.x=i.x=n.touches[0].clientX,r.y=i.y=n.touches[0].clientY,c(window,"touchmove",t),c(window,"touchend",e)),q&&(b.style[p]=o(I.x+"px",I.y+"px")+(I.rot?" rotate("+I.rot+"deg)":""),b.style.zIndex=E++)}function f(n){n.appendChild(b),I.$root=n}function s(){I.$root&&I.$root.removeChild(b),I.$root=null}function l(n){"front"===n?("back"===I.side&&b.removeChild(k),I.side="front",b.appendChild(w),I.setRankSuit(I.rank,I.suit)):("front"===I.side&&b.removeChild(w),I.side="back",b.appendChild(k),b.setAttribute("class","card"))}function h(n){I.i=n,I.rank=n%16+1,I.suit=n/16|0}var y,p=e("transform"),m=t%16+1,x=t/16|0,g=(52-t)/4,b=i("div"),w=i("div"),k=i("div"),q=!1,C=!1,I={i:t,rank:m,suit:x,pos:t,$el:b,mount:f,unmount:s,setSide:l,morph:h},M=v.modules;w.classList.add("face"),k.classList.add("back"),b.style[p]=o(-g+"px",-g+"px"),I.x=-g,I.y=-g,I.z=g,I.rot=0,I.setSide("back"),c(b,"mousedown",u),c(b,"touchstart",u),c(b,"mouseover",function(){"back"!==I.side&&(b.style.zIndex=E++)});for(y in M)r(M[y]);return I.animateTo=function(t){var e,r,i,u,a,c,d=t.delay,f=t.duration,s=t.x,l=void 0===s?I.x:s,h=t.y,y=void 0===h?I.y:h,m=t.rot,v=void 0===m?I.rot:m,x=t.ease,g=t.onStart,w=t.onProgress,k=t.onComplete;n(d,f).start(function(){e=I.x||0,r=I.y||0,i=I.rot||0,g&&g()}).progress(function(n){var t=A[x||"cubicInOut"](n);u=l-e,a=y-r,c=v-i,w&&w(n,t),I.x=e+u*t,I.y=r+a*t,I.rot=i+c*t,b.style[p]=o(I.x+"px",I.y+"px")+(c?"rotate("+I.rot+"deg)":"")}).end(function(){k&&k()})},I.setRankSuit=function(n,t){var e=a(t);b.setAttribute("class","card "+e+" rank"+n)},I.setRankSuit(m,x),I.enableDragging=function(){q||(q=!0,b.style.cursor="move")},I.enableFlipping=function(){C||(C=!0)},I.disableFlipping=function(){C&&(C=!1)},I.disableDragging=function(){q&&(q=!1,b.style.cursor="")},I}function a(n){return 0===n?"spades":1===n?"hearts":2===n?"clubs":3===n?"diamonds":"joker"}function c(n,t,e){n.addEventListener(t,e)}function d(n,t,e){n.removeEventListener(t,e)}function f(n){return n*Math.PI/180}function s(n){for(var t,e,o=n.length-1;o;o--)t=Math.random()*o|0,e=n[o],n[o]=n[t],n[t]=e;return n}function l(){return window.getComputedStyle(document.body).getPropertyValue("font-size").slice(0,-2)}function h(n){var t=Math.round(Math.random())?-1:1;return t*n}function y(n){var t=[];return t.push(3*n),t.push(7*n+1),t.push(10*n+2),t}function p(n){function t(n){return function(){var t=this,o=arguments;e(function(e){n.apply(t,r.concat.apply(e,o))})}}function e(n){n&&(i.push(n),1===i.length&&o())}function o(){i[0](function(n){if(n)throw n;i=i.slice(1),i.length&&o()})}var r=Array.prototype,i=[];return n.queue=e,n.queued=t,n}function m(n){function t(n,t,e){i[n]||(i[n]=[]),i[n].push({cb:t,ctx:e})}function e(n,t,e){i[n]||(i[n]=[]),i[n].push({cb:t,ctx:e,once:!0})}function o(n){var t=this,e=Array.prototype.slice(arguments,1),o=i[n]||[];o.filter(function(n){return n.cb.apply(t,e),!n.once})}function r(n,t){return n?t?void(i[n]=i[n].filter(function(n){return n.cb!==t})):void(i[n]=[]):void(i={})}n||(n={});var i={};return n.on=t,n.one=e,n.off=r,n.trigger=o,n}function v(n){function t(n){c=n,c.appendChild(s)}function e(){c.removeChild(s)}function o(n){n.deck&&n.deck(l)}function r(n){n.length===l.hand.length&&n.forEach(function(n,t){var e=l.hand[t];e.morph(n)})}function a(n){var t=new Array(n.length),e=0;n.forEach(function(n,o){var r=!1;if(l.hand.forEach(function(e){e.i===n&&(t[o]=e,r=!0)}),!r){var i=l.kitty[e++];i.morph(n),i.setSide("front"),t[o]=i}}),l.hand=t,l.kitty=[]}var c,d,f=new Array(n?63:43),s=i("div"),l=m({mount:t,unmount:e,cards:f,$el:s,transform:r,addKitty:a}),h=v.modules;p(l);for(d in h)o(h[d]);s.classList.add("deck");var y,x=0,g=[13,45];n||g.push(2,3,4,11,12,18,19,27,28,29,34,35,36,43,44,50,51,59,60,61);for(var b=1;x<f.length;b++)-1===g.indexOf(b)&&(y=f[x]=u(b-1),y.mount(s),x++);return l}var x,g=[];window.requestAnimationFrame||(window.requestAnimationFrame=function(n){setTimeout(n,0)});var b,w,k,q,C,I,M=document.createElement("p").style,S={},E=63,A={linear:function(n){return n},quadIn:function(n){return n*n},quadOut:function(n){return n*(2-n)},quadInOut:function(n){return.5>n?2*n*n:-1+(4-2*n)*n},cubicIn:function(n){return n*n*n},cubicOut:function(n){return--n*n*n+1},cubicInOut:function(n){return.5>n?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1},quartIn:function(n){return n*n*n*n},quartOut:function(n){return 1- --n*n*n*n},quartInOut:function(n){return.5>n?8*n*n*n*n:1-8*--n*n*n*n},quintIn:function(n){return n*n*n*n*n},quintOut:function(n){return 1+--n*n*n*n*n},quintInOut:function(n){return.5>n?16*n*n*n*n*n:1+16*--n*n*n*n*n}},O={deck:function(n){function t(t,e){var o=n.hand,r=o.length;w=l();for(var i=new Array(r),u=0;r>u;u++)i[u]=u;e&&s(i),o.forEach(function(n,e){n.showHand(e,r,i[e],function(n){n===o.length-1&&t()}),n.setSide("front")})}n.showHand=n.queued(t)},card:function(n){var t=n.$el;n.showHand=function(e,o,r,i){var u=r/4,a=10*r,c=r/(o-1)*14-7;n.animateTo({delay:a,duration:150,x:-u,y:-u+200,rot:0}),n.animateTo({delay:300+a,duration:300,x:55*Math.cos(f(c-90))*w/16+55*(r-o/2+.5),y:55*Math.sin(f(c-90))*w/16+200+4*Math.abs(r-o/2),rot:c,onStart:function(){t.style.zIndex=r},onComplete:function(){i(e)}})}}},T={deck:function(n){function t(t,e){var o=n.cards.filter(function(n){return"front"===n.side}).length/n.cards.length;n.cards.forEach(function(n,t){n.setSide(e?e:o>.5?"back":"front")}),t()}n.flip=n.queued(t)}},z={deck:function(n){function t(t,e){var o=n.cards;o.sort(function(n,t){return e?n.i-t.i:t.i-n.i}),o.forEach(function(n,r){n.sort(r,o.length,function(n){n===o.length-1&&t()},e)})}n.sort=n.queued(t)},card:function(n){var t=n.$el;n.sort=function(e,o,r,i){var u=e/4,a=10*e;n.animateTo({delay:a,duration:400,x:-u,y:-150,rot:0,onComplete:function(){t.style.zIndex=e}}),n.animateTo({delay:a+500,duration:400,x:-u,y:-u,rot:0,onComplete:function(){r(e)}})}}},$={deck:function(n){function t(t){var e=n.cards;k=l(),s(e),e.forEach(function(n,o){n.pos=o,n.shuffle(function(n){n===e.length-1&&t()})})}n.shuffle=n.queued(t)},card:function(n){var t=n.$el;n.shuffle=function(e){var o=n.pos,r=o/4,i=2*o;n.animateTo({delay:i,duration:200,x:h(40*Math.random()+20)*k/16,y:-r,rot:0}),n.animateTo({delay:200+i,duration:200,x:-r,y:-r,rot:0,onStart:function(){t.style.zIndex=o},onComplete:function(){e(o)}})}}},D={deck:function(n){function t(t){var e=n.cards,o=e.length,r=63==o,i=r?3:2;q=l(),n.hand=[],n.kitty=[],e.reverse().forEach(function(u,a){u.pos=a,u.deal(a,o,r,function(n){n===e.length-1&&t()}),u.player===i?n.hand.push(u):-1===u.player&&n.kitty.push(u)}),n.times++}n.deal=n.queued(t),n.times=0},card:function(n){var t=n.$el;n.deal=function(e,o,r,i){var u,a,c,d=100*e,s=r?6:4,l=y(s),h=function(n){return-1!==l.indexOf(n)?-1:n<l[0]?n/3|0:n<l[1]?(n-l[0]-1)/4|0:(n-l[1]-1)/3|0},p=function(n){return n<=l[0]?0:n<=l[1]?1:2},m=function(n){return n<=l[0]?n%3:n<=l[1]?(n-l[0]-1)%4+3:(n-l[1]-1)%3+7};-1!==h(e)?(c=h(e)*(360/s)+m(e),u=155*Math.cos(f(c-90))*q/16,a=155*Math.sin(f(c-90))*q/16):(c=300+3*p(e),u=0+3*p(e),a=0+3*p(e)),n.player=h(e),n.animateTo({delay:d,duration:300,x:u,y:a,rot:c,onStart:function(){t.style.zIndex=m(e)},onComplete:function(){i(e)}})}}},F={deck:function(t){function e(e){var o=t.cards;o.forEach(function(t,r){t.setSide("front"),t.intro(r,function(r){n(250,0).start(function(){t.setSide("back")}),r===o.length-1&&e()})})}t.intro=t.queued(e)},card:function(n){var t=e("transform"),r=n.$el;n.intro=function(e,i){var u=500+10*e,a=e/4;r.style[t]=o(-a+"px","-250px"),r.style.opacity=0,n.x=-a,n.y=-250-a,n.rot=0,n.animateTo({delay:u,duration:1e3,x:-a,y:-a,onStart:function(){r.style.zIndex=e},onProgress:function(n){r.style.opacity=n},onComplete:function(){r.style.opacity="",i&&i(e)}})}}},P={deck:function(n){function t(t){var e=n.cards,o=e.length;C=l(),e.forEach(function(n,r){n.fan(r,o,function(n){n===e.length-1&&t()})})}n.fan=n.queued(t)},card:function(n){var t=n.$el;n.fan=function(e,o,r){var i=e/4,u=10*e,a=e/(o-1)*260-130;n.animateTo({delay:u,duration:300,x:-i,y:-i,rot:0}),n.animateTo({delay:300+u,duration:300,x:55*Math.cos(f(a-90))*C/16,y:55*Math.sin(f(a-90))*C/16,rot:a,onStart:function(){t.style.zIndex=e},onComplete:function(){r(e)}})}}},L={deck:function(n){function t(t){var e=n.cards;I=l(),e.forEach(function(n){n.bysuit(function(n){n===e.length-1&&t()})})}n.bysuit=n.queued(t)},card:function(n){var t=n.rank,e=n.suit;n.bysuit=function(o){var r=n.i,i=10*r;n.animateTo({delay:i,duration:400,x:-Math.round(8*(6.75-t)*I/16),y:-Math.round(92*(1.5-e)*I/16),rot:0,onComplete:function(){o(r)}})}}};return v.animationFrames=n,v.ease=A,v.modules={bysuit:L,fan:P,intro:F,deal:D,shuffle:$,sort:z,flip:T,showHand:O},v.Card=u,v.prefix=e,v.translate=o,v}();